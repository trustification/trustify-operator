name: Install Trustify Bundle
description: |
  Install Trustify Operator.
inputs:
  bundle_image:
    description: "image url for operator bundle container image"
    required: false
    default: ""
  namespace:
    description: "the namespace where Trustify should be installed"
    required: false
    default: ""
  trustify_cr:
    description: "JSON encoded Trustify Custom Resource (CR) string"
    required: false
    default: ""
runs:
  using: "composite"
  steps:
    - name: Install kubectl
      shell: bash
      run: |
        if command -v kubectl >/dev/null 2>&1; then
          echo "kubectl is already installed...yay"
          exit 0
        fi
        curl -LO "https://dl.k8s.io/release/$(curl -L -s https://dl.k8s.io/release/stable.txt)/bin/linux/amd64/kubectl"
        sudo install -o root -g root -m 0755 kubectl /usr/local/bin/kubectl
    - name: Install operator-sdk
      shell: bash
      run: |
        if command -v operator-sdk >/dev/null 2>&1; then
          echo "operator-sdk is already installed...yay"
          exit 0
        fi
        curl -LO https://github.com/operator-framework/operator-sdk/releases/download/v1.35.0/operator-sdk_linux_amd64
        sudo install -o root -g root -m 0755 operator-sdk_linux_amd64 /usr/local/bin/operator-sdk
    - name: Install Trustify
      env:
        OPERATOR_BUNDLE_IMAGE: ${{ inputs.bundle_image }}
        NAMESPACE: ${{ inputs.namespace }}
        trustify_cr: ${{ inputs.trustify_cr }}
      run: make install-trustify-bundle
      working-directory: ${{ github.action_path }}/../../..
      shell: bash
    - name: Upload logs on fail
      if: ${{ failure() }}
      uses: actions/upload-artifact@v4
      with:
        name: debug-output
        path: /tmp/trustify-bundle-debug